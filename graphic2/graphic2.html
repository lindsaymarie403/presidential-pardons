<!DOCTYPE html>
<head>
<meta charset="utf-8">
<link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,400i,700,700i|Poppins:300,400,500,600,700&amp;subset=latin-ext" rel="stylesheet">

<style>

#container {
	margin-top:20px;
	margin-bottom:20px;
	padding-left:20px;
	padding-top:10px;
	padding-right:30px;
	padding-bottom:10px;
	border-left:1px solid black;
	border-bottom:14pt solid black;
	border-top:1px solid black;
	border-right:1px solid black;
	box-shadow:5px 5px 10px gainsboro;
	min-width: 400px;
	max-width: 600px;
	height: auto;
	margin-left:auto;
	margin-right:auto;
}

h1 {
  font-family: 'Droid Serif', serif;
	font-weight:600;
	font-size:20pt;
	fill:#2c2c2c;
  margin-bottom: -2px;
}

h2 {
  font-family:'Poppins', sans-serif;
  fill:grey;
  font-weight:300;
  font-size:12pt;
  line-height: 14pt;
}

h3 {
  font-family:'Poppins', sans-serif;
	fill:grey;
	font-weight:300;
	font-size:8pt;
  text-transform: uppercase;
  margin-bottom: 0px;
}

.bar {
  fill: #fbd603;
}

.bar1 {
  fill: #d3d3d3;
}

</style>

</head>

<body>

<div id="container">
<div id="text">
  <h1>Trump Grants High-Profile Pardons While Backlog of Applications Grows</h1>
  <h3>By Lindsay Huth</h3>
  <h2>Total Clemency Petitions Pending Each Year</h2>
</div>
<div id="chart1"></div>
<div id="chart2"></div>

</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var margin = {top: 20, right: 20, bottom: 16, left: 50},
    width = 625 - margin.left - margin.right,
    height = 62 - margin.top - margin.bottom;

var svg = d3.select('#chart1')
  .append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom);

var xScale = d3.scaleBand().rangeRound([0, width]).padding(0.3),
    yScale = d3.scaleLinear().rangeRound([height, 0]);

var xAxis = d3.axisBottom(xScale);

var arc1 = d3.arc()
    .innerRadius(24)
    .outerRadius(25)
    .startAngle(- Math.PI / 2)
    .endAngle(0);

var arc2 = d3.arc()
    .innerRadius(24)
    .outerRadius(25)
    .startAngle(Math.PI / 2)
    .endAngle(0);

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("positive.csv", function(d) {
  d.year = d.year;
  d.positive = +d.positive;
  return d;
}, function(error, data) {
  if (error) throw error;

  xScale.domain(data.map(function(d) { return d.year; }));
  yScale.domain([0, d3.max(data, function(d) { return d.positive; })]);

  g.append("g")
        .attr("class", "axis axis--x2")
        .attr("transform", "translate(0," + height + ")")
        .style("font-size", "10px")
        .style("font-family","Poppins")
        .call(xAxis.tickValues([1980, 1990, 2000, 2010]));

  g.append("g")
      .attr("class", "axis axis--y")
      .style("font-size", "10px")
      .style("font-family","Poppins")
      .call(d3.axisLeft(yScale).tickValues([d3.max(data, function(d) { return d.positive; })]));

  g.selectAll(".bar")
    .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return xScale(d.year); })
      .attr("y", function(d) { return yScale(d.positive); })
      .attr("width", xScale.bandwidth())
      .attr("height", function(d) { return height - yScale(d.positive); });

});

document.addEventListener("DOMContentLoaded", resize);
d3.select(window).on('resize', resize);

function resize() {
	console.log('----resize function----');
  // update width
  width = parseInt(d3.select('#chart1').style("width"), 10);
  width = width - margin.left - margin.right;

  height = parseInt(d3.select('#chart1').style("height"));
  height = height - margin.top - margin.bottom;
	console.log('----resiz width----'+width);
	console.log('----resiz height----'+height);
  // resize the chart

  xScale.rangeRound([0, width]).padding(0.3);
  yScale.rangeRound([height, 0]);

  xAxis.ticks(Math.max(width/50, 2));

  d3.select(svg.node().parentNode)
      .attr('width', (width + margin.left + margin.right) + 'px');

  svg.selectAll('.bar')
  	.attr("x", function(d) { return xScale(d.year); })
    .attr("width", xScale.bandwidth());

  svg.select('.axis.axis--x2').call(xAxis);

	console.log('----resize function----');
	// update width
	width1 = parseInt(d3.select('#chart2').style("width"), 10);
	width1 = width1 - margin1.left - margin1.right;

	height1 = parseInt(d3.select('#chart2').style("height"));
	height1 = height1 - margin1.top - margin1.bottom;
	console.log('----resiz width----'+width1);
	console.log('----resiz height----'+height1);
	// resize the chart

	xScale1.rangeRound([0, width1]).padding(0.3);
	yScale1.rangeRound([height1, 0]);

	xAxis1.ticks(Math.max(width1/50, 2));

	d3.select(svg1.node().parentNode)
			.attr('width', (width1 + margin1.left + margin1.right) + 'px');

	svg1.selectAll('.bar1')
		.attr("x", function(d) { return xScale1(d.year); })
		.attr("width", xScale1.bandwidth());

	svg1.select('.axis.axis--x.two').call(xAxis1);

	svg1.selectAll(".anno1")
		.style("text-anchor", "end")
		.attr("x", (function(d) { return xScale1(d.year) + margin1.left + xScale1.bandwidth() - (xScale1.bandwidth()/1.25) - 30; }  ));

	svg1.selectAll(".anno2")
		.style("text-anchor", "end")
		.attr("x", (function(d) { return xScale1(d.year) + margin1.left + xScale1.bandwidth() - (xScale1.bandwidth()/1.25) - 30; }  ));

}

</script>

<script>

var margin1 = {top: 5, right: 20, bottom: 30, left: 50},
    width1 = 625 - margin1.left - margin1.right,
    height1 = 585 - margin1.top - margin1.bottom;

var svg1 = d3.select('#chart2')
  .append('svg')
    .attr('width', width1 + margin1.left + margin1.right)
    .attr('height', height1 + margin1.top + margin1.bottom);

var xScale1 = d3.scaleBand().rangeRound([0, width1]).padding(0.3),
    yScale1 = d3.scaleLinear().rangeRound([0, height1]);

var xAxis1 = d3.axisTop(xScale1);

var g1 = svg1.append("g")
    .attr("transform", "translate(" + margin1.left + "," + margin1.top + ")");

d3.csv("negative.csv", function(d) {
  d.year = d.year;
  d.negative = +d.negative;
  return d;
}, function(error, data) {
  if (error) throw error;

  xScale1.domain(data.map(function(d) { return d.year; }));
  yScale1.domain([0,d3.min(data, function(d) { return d.negative; })]);

  g1.append("g")
        .attr("class", "axis axis--x two")
        .attr("transform", "translate(0,0)")
        .style("font-size", "10px")
        .style("font-family","Poppins")
        .call(xAxis1.tickValues([1980,1990,2000,2010]));

  g1.append("g")
      .attr("class", "axis axis--y two")
      .style("font-size", "10px")
      .style("font-family","Poppins")
      .call(d3.axisLeft(yScale1).tickValues([d3.min(data, function(d) { return d.negative; })]));

  svg1.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0)
      .attr("x",0 - (height1 / 2.5))
      .attr("dy", "1em")
      .attr("text-anchor", "end")
      .attr("font-size", "12px")
      .attr("font-family","Poppins")
      .text("Number Granted");

  g1.selectAll(".bar")
    .data(data)
    .enter().append("rect")
      .attr("class", "bar1")
      .attr("x", function(d) { return xScale1(d.year); })
      .attr("y", 1)
      .attr("width", xScale1.bandwidth())
      .attr("height", function(d) { return yScale1(d.negative); });

	svg1.selectAll(".anno1")
			.data(data)
		.enter().append("text")
			.attr("class","anno1")
			.attr("y", function(d) { return yScale1(d.negative); })
			.text("Obama launches his")
			.attr("font-size", "11px")
			.attr("font-family","Poppins")
			.attr("fill","#939393")
			.style("display", function(d) {
				 var disp;
				 if (d.year === "2014") { disp = "inline";
			 } else { disp = "none";
				 } return disp;
			 });

	 svg1.selectAll(".anno2")
			 .data(data)
		 .enter().append("text")
			.attr("class","anno2")
			 .attr("y", function(d) { return yScale1(d.negative) + 15; })
			 .text("clemency initiative")
			 .attr("font-size", "11px")
			 .attr("font-family","Poppins")
			 .attr("fill","#939393")
			 .style("display", function(d) {
					var disp;
					if (d.year === "2014") { disp = "inline";
				} else { disp = "none";
					} return disp;
				});

});

/*thanks to these resources:
https://bl.ocks.org/d3noob/bdf28027e0ce70bd132edc64f1dd7ea4
http://www.cagrimmett.com/til/2016/04/26/responsive-d3-bar-chart.html
https://bl.ocks.org/curran/3a68b0c81991e2e94b19
*/

</script>

</body>
