<!DOCTYPE html>
<meta charset="utf-8">
<style>

.bar {
  fill: steelblue;
}

</style>
<div id="chart1"></div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = 1000 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

var svg = d3.select('#chart1')
  .append('svg')
    .attr('width', width + margin.left + margin.right)
    .attr('height', height + margin.top + margin.bottom);

var xScale = d3.scaleBand().rangeRound([0, width]).padding(0.3),
    yScale = d3.scaleLinear().rangeRound([height, 0]);

var xAxis = d3.axisBottom(xScale);

var arc = d3.arc()
    .innerRadius(24)
    .outerRadius(25)
    .startAngle(- Math.PI / 2)
    .endAngle(0);

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("graphic1.csv", function(d) {
  d.president = d.president;
  d.granted = +d.granted;
  return d;
}, function(error, data) {
  if (error) throw error;

  xScale.domain(data.map(function(d) { return d.president; }));
  yScale.domain([0, d3.max(data, function(d) { return d.granted; })]);

  g.append("g")
        .attr("class", "axis axis--x")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(yScale).ticks(5))

  svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0)
      .attr("x",0 - (height / 2.5))
      .attr("dy", "1em")
      .attr("text-anchor", "end")
      .text("Number Granted");

  g.selectAll(".bar")
    .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return xScale(d.president); })
      .attr("y", function(d) { return yScale(d.granted); })
      .attr("width", xScale.bandwidth())
      .attr("height", function(d) { return height - yScale(d.granted); });

  svg.selectAll(".text")
  	 .data(data)
  	  .enter()
  	  .append("text")
  	  .attr("class","label")
  	  .attr("x", (function(d) { return xScale(d.president) + 70; }  ))
  	  .attr("y", function(d) { return yScale(d.granted) + 1; })
  	  .attr("dy", ".75em")
      .attr("font-size",".8em")
  	  .text(function(d) { return d.granted; })
      .style("text-anchor","middle");

  svg.selectAll(".anno1")
      .data(data)
    .enter().append("text")
      .attr("class","anno1")
      .attr("y", function(d) { return yScale(d.granted) - 35; })
      .text("Reagan began efforts to reduce ")
      .attr("font-size", "13px")
      .style("display", function(d) {
         var disp;
         if (d.president === "Reagan") { disp = "inline";
       } else { disp = "none";
         } return disp;
       });

   svg.selectAll(".anno2")
       .data(data)
     .enter().append("text")
      .attr("class","anno2")
       .attr("y", function(d) { return yScale(d.granted) - 20; })
       .text("politically motivated pardons")
       .attr("font-size", "13px")
       .style("display", function(d) {
          var disp;
          if (d.president === "Reagan") { disp = "inline";
        } else { disp = "none";
          } return disp;
        });

    svg.selectAll(".curve1")
      .data(data)
    .enter().append("path")
      .attr("class","curve1")
      .attr("d", arc)
      .attr("transform", "translate(0,110)")
      .style("display", function(d) {
         var disp;
         if (d.president === "Reagan") { disp = "inline";
       } else { disp = "none";
         } return disp;
       });;
});

document.addEventListener("DOMContentLoaded", resize);
d3.select(window).on('resize', resize);

function resize() {
	console.log('----resize function----');
  // update width
  width = parseInt(d3.select('#chart1').style("width"), 10);
  width = width - margin.left - margin.right;

  height = parseInt(d3.select('#chart1').style("height"));
  height = height - margin.top - margin.bottom;
	console.log('----resiz width----'+width);
	console.log('----resiz height----'+height);
  // resize the chart

  xScale.rangeRound([0, width]).padding(0.3);
  yScale.rangeRound([height, 0]);

  //yAxis.ticks(Math.max(height/50, 2));
  xAxis.ticks(Math.max(width/50, 2));

  d3.select(svg.node().parentNode)
      .attr('width', (width + margin.left + margin.right) + 'px');

  svg.selectAll('.bar')
  	.attr("x", function(d) { return xScale(d.president); })
    .attr("width", xScale.bandwidth());

  svg.selectAll(".label")
    .attr("x", (function(d) { return xScale(d.president) + margin.left + xScale.bandwidth() / 2; }  ))
    .attr("y", function(d) { return yScale(d.granted) + 1; })
    .attr("dy", ".75em");

  svg.selectAll(".anno1")
    .attr("x", (function(d) { return xScale(d.president) + margin.left + xScale.bandwidth(); }  ));

  svg.selectAll(".anno2")
    .attr("x", (function(d) { return xScale(d.president) + margin.left + xScale.bandwidth(); }  ));

  svg.selectAll(".curve1")
    .attr("transform",function(d) { return "translate(" + (xScale(d.president) + margin.left + xScale.bandwidth() - 10) + ",110)";});

    //.attr("transform", "translate(" + parseInt(d3.select('.label:nth-child(4)').attr("x")) + ",110)")

  svg.select('.axis.axis--x').call(xAxis);

}

/*thanks to these resources:
https://bl.ocks.org/d3noob/bdf28027e0ce70bd132edc64f1dd7ea4
http://www.cagrimmett.com/til/2016/04/26/responsive-d3-bar-chart.html
https://bl.ocks.org/curran/3a68b0c81991e2e94b19
*/

</script>
